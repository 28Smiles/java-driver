<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="High performance Java client for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>Java Driver for Apache Cassandra - LatencyAwarePolicy.Builder</title>

    <link rel="icon" href="../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../favicon.png">
    <link href="../../../css/style.css" rel="stylesheet">
    <link href="../../../css/pygments.css" rel="stylesheet">
    <link href="../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs" data-spy="scroll" data-target=".side-nav">
    <header class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../">Java Driver for Apache Cassandra</a>
        </div>
        <div class="collapse navbar-collapse" ng-controller="search">
          <ul class="nav navbar-nav">
            
            <li>
              <a href="../../../">Introduction</a>
            </li>
            
            <li>
              <a href="../../../features/">Features</a>
            </li>
            
            <li class="active">
              <a href="../../">API docs</a>
            </li>
            
          </ul>
          <form class="navbar-form form-search navbar-right dropdown visible-lg-block" ng-class="{open: hasResults}" role="search" ng-submit="submit()">
            <div class="form-group has-feedback">
              <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('2.0.10')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
            </div>
            <ul class="dropdown-menu" role="menu">
              <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
            </ul>
          </form>
        </div>
      </div>
    </header>

    <div class="container" id="content">
      <div class="row">
        <div class="col-md-9 content">
          <nav class="crumbs">
            <ol class="breadcrumb">
              
              <li>
                <div class="dropdown">
                  <button id="current-version" class="btn btn-default btn-sm" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    2.0.10
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                  
                    <li class="disabled"><a href="./">2.0.10</a></li>
                  
                    <li><a href="../../../2.1.5/api/com.datastax.driver.core.policies/LatencyAwarePolicy.Builder/">2.1.5</a></li>
                  
                  </ul>
                </div>
              </li>
              
              
              
              
              <li><a href="../../../">Introduction</a></li>
              
              
              
              
              
              <li><a href="../../">API docs</a></li>
              
              
              
              
              
              <li><a href="../">com.datastax.driver.core.policies</a></li>
              
              
              
              
              
              <li class="active">LatencyAwarePolicy.Builder</li>
              
              
              
            </ol>
          </nav>
          

<div class="page-header">
  <h1 id="class-builder">
    <small>class</small>
    <abbr title="com.datastax.driver.core.policies.LatencyAwarePolicy.Builder">Builder</abbr>
  <a class="anchor" href="#class-builder" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>
</div>

<p>Helper builder object to create a latency aware policy. </p>
<p> This helper allows to configure the different parameters used by <code>LatencyAwarePolicy</code>. The only mandatory parameter is the child policy that will be wrapped with latency awareness. The other parameters can be set through the methods of this builder, but all have defaults (that are documented in the javadoc of each method) if you donâ€™t. </p>
<p> If you observe that the resulting policy excludes hosts too aggressively or not enough so, the main parameters to check are the exclusion threshold (<code><a href="#withExclusionThreshold%28double%29">LatencyAwarePolicy.Builder#withExclusionThreshold</a></code>) and scale (<code><a href="#withScale%28long%2C+TimeUnit%29">LatencyAwarePolicy.Builder#withScale</a></code>).</p>
<dl class="dl-horizontal notes">
<dt><span class="label label-info">Since</span></dt>
<dd>1.0.4</dd>
</dl>
<h2 id="extends">Extends<a class="anchor" href="#extends" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<div class="class-parent">
  <code><abbr title="java.lang.Object">Object</abbr></code>
</div>




<h2 id="constructors">Constructors<a class="anchor" href="#constructors" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<div class="class-constructors">
  
  <div class="panel panel-default member-definition" id="LatencyAwarePolicy.Builder%28LoadBalancingPolicy%29">
    <div class="panel-heading constructor-heading">
      <a class="anchor" href="#LatencyAwarePolicy.Builder%28LoadBalancingPolicy%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      LatencyAwarePolicy.Builder <big>(</big><code><a href="../LoadBalancingPolicy/">LoadBalancingPolicy</a></code> childPolicy<big>)</big>
    </div>
    <div class="panel-body constructor-body">
      <p>Creates a new latency aware policy builder given the child policy that the resulting policy wraps.</p>

      <dl class="tags">
<dt class="tag-title">Parameters:</dt>
<dd class="tag-content"><table class="table table-striped param">
<thead><tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><var>childPolicy</var></td>
<td><code><a href="../LoadBalancingPolicy/">LoadBalancingPolicy</a></code></td>
<td>
<p>the load balancing policy to wrap with latency awareness.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
</div>

<h2 id="methods">Methods<a class="anchor" href="#methods" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<div class="class-methods">
  
  <div class="panel panel-default member-definition" id="withExclusionThreshold%28double%29">
    <div class="panel-heading method-heading">
      <a class="anchor" href="#withExclusionThreshold%28double%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      <code><a href="./">Builder</a></code> withExclusionThreshold <big>(</big><code>double</code> exclusionThreshold<big>)</big>
    </div>
    <div class="panel-body method-body">
      <p>Sets the exclusion threshold to use for the resulting latency aware policy. </p>
<p> The exclusion threshold controls how much worse the average latency of a node must be compared to the fastest performing node for it to be penalized by the policy. </p>
<p> The default exclusion threshold (if this method is not called) is <b>2</b>. In other words, the resulting policy excludes nodes that are more than twice slower than the fastest node.</p>

      <dl class="tags">
<dt class="tag-title">Parameters:</dt>
<dd class="tag-content"><table class="table table-striped param">
<thead><tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><var>exclusionThreshold</var></td>
<td><code>double</code></td>
<td>
<p>the exclusion threshold to use. Must be greater or equal to 1.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Throws:</dt>
<dd class="tag-content"><table class="table table-striped throw">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><abbr title="java.lang.IllegalArgumentException">IllegalArgumentException</abbr></code></td>
<td>
<p>if <code>exclusionThreshold  1</code>.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Returns:</dt>
<dd class="tag-content"><table class="table table-striped return">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><a href="./">Builder</a></code></td>
<td>
<p>this builder.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
  <div class="panel panel-default member-definition" id="withScale%28long%2C+TimeUnit%29">
    <div class="panel-heading method-heading">
      <a class="anchor" href="#withScale%28long%2C+TimeUnit%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      <code><a href="./">Builder</a></code> withScale <big>(</big><code>long</code> scale, <code><abbr title="java.util.concurrent.TimeUnit">TimeUnit</abbr></code> unit<big>)</big>
    </div>
    <div class="panel-body method-body">
      <p>Sets the scale to use for the resulting latency aware policy. </p>
<p> The <code>scale</code> provides control on how the weight given to older latencies decreases over time. For a given host, if a new latency (l) is received at time (t), and the previously calculated average is (prev) calculated at time (tâ€™), then the newly calculated average (avg) for that host is calculated thusly: [ d = \frac{t - tâ€™}{scale} \ \alpha = 1 - \left(\frac{\ln(d+1)}{d}\right) \ avg = \alpha * l + (1-\alpha) * prev ] Typically, with a <code>scale</code> of 100 milliseconds (the default), if a new latency is measured and the previous measure is 10 millisecond old (so (d=0.1)), then (\alpha) will be around (0.05). In other words, the new latency will weight 5% of the updated average. A bigger scale will get less weight to new measurements (compared to previous ones), a smaller one will give them more weight. </p>
<p> The default scale (if this method is not used) is of <b>100 milliseconds</b>. If unsure, try this default scale first and experiment only if it doesnâ€™t provide acceptable results (hosts are excluded too quickly or not fast enough and tuning the exclusion threshold doesnâ€™t help).</p>

      <dl class="tags">
<dt class="tag-title">Parameters:</dt>
<dd class="tag-content"><table class="table table-striped param">
<thead><tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody>
<tr>
<td><var>scale</var></td>
<td><code>long</code></td>
<td>
<p>the scale to use.</p>
</td>
</tr>
<tr>
<td><var>unit</var></td>
<td><code><abbr title="java.util.concurrent.TimeUnit">TimeUnit</abbr></code></td>
<td>
<p>the unit of <code>scale</code>.</p>
</td>
</tr>
</tbody>
</table></dd>
<dt class="tag-title">Throws:</dt>
<dd class="tag-content"><table class="table table-striped throw">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><abbr title="java.lang.IllegalArgumentException">IllegalArgumentException</abbr></code></td>
<td>
<p>if <code>scale  0</code>.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Returns:</dt>
<dd class="tag-content"><table class="table table-striped return">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><a href="./">Builder</a></code></td>
<td>
<p>this builder.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
  <div class="panel panel-default member-definition" id="withRetryPeriod%28long%2C+TimeUnit%29">
    <div class="panel-heading method-heading">
      <a class="anchor" href="#withRetryPeriod%28long%2C+TimeUnit%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      <code><a href="./">Builder</a></code> withRetryPeriod <big>(</big><code>long</code> retryPeriod, <code><abbr title="java.util.concurrent.TimeUnit">TimeUnit</abbr></code> unit<big>)</big>
    </div>
    <div class="panel-body method-body">
      <p>Sets the retry period for the resulting latency aware policy. </p>
<p> The retry period defines how long a node may be penalized by the policy before it is given a 2nd change. More precisely, a node is excluded from query plans if both his calculated average latency is <code>exclusionThreshold</code> times slower than the fastest node average latency (at the time the query plan is computed) <b>and</b> his calculated average latency has been updated since less than <code>retryPeriod</code>. Since penalized nodes will likely not see their latency updated, this is basically how long the policy will exclude a node.</p>

      <dl class="tags">
<dt class="tag-title">Parameters:</dt>
<dd class="tag-content"><table class="table table-striped param">
<thead><tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody>
<tr>
<td><var>retryPeriod</var></td>
<td><code>long</code></td>
<td>
<p>the retry period to use.</p>
</td>
</tr>
<tr>
<td><var>unit</var></td>
<td><code><abbr title="java.util.concurrent.TimeUnit">TimeUnit</abbr></code></td>
<td>
<p>the unit for <code>retryPeriod</code>.</p>
</td>
</tr>
</tbody>
</table></dd>
<dt class="tag-title">Throws:</dt>
<dd class="tag-content"><table class="table table-striped throw">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><abbr title="java.lang.IllegalArgumentException">IllegalArgumentException</abbr></code></td>
<td>
<p>if <code>retryPeriod  0</code>.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Returns:</dt>
<dd class="tag-content"><table class="table table-striped return">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><a href="./">Builder</a></code></td>
<td>
<p>this builder.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
  <div class="panel panel-default member-definition" id="withUpdateRate%28long%2C+TimeUnit%29">
    <div class="panel-heading method-heading">
      <a class="anchor" href="#withUpdateRate%28long%2C+TimeUnit%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      <code><a href="./">Builder</a></code> withUpdateRate <big>(</big><code>long</code> updateRate, <code><abbr title="java.util.concurrent.TimeUnit">TimeUnit</abbr></code> unit<big>)</big>
    </div>
    <div class="panel-body method-body">
      <p>Sets the update rate for the resulting latency aware policy.
 The update rate defines how often the minimum average latency is recomputed. While the average latency score of each node is computed iteratively (updated each time a new latency is collected), the minimum score needs to be recomputed from scratch every time, which is slightly more costly. For this reason, the minimum is only re-calculated at the given fixed rate and cached between re-calculation. </p>
<p> The default update rate if <b>100 milliseconds</b>, which should be appropriate for most applications. In particular, note that while we want to avoid to recompute the minimum for every query, that computation is not particularly intensive either and there is no reason to use a very slow rate (more than second is probably unnecessarily slow for instance).</p>

      <dl class="tags">
<dt class="tag-title">Parameters:</dt>
<dd class="tag-content"><table class="table table-striped param">
<thead><tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody>
<tr>
<td><var>updateRate</var></td>
<td><code>long</code></td>
<td>
<p>the update rate to use.</p>
</td>
</tr>
<tr>
<td><var>unit</var></td>
<td><code><abbr title="java.util.concurrent.TimeUnit">TimeUnit</abbr></code></td>
<td>
<p>the unit for <code>updateRate</code>.</p>
</td>
</tr>
</tbody>
</table></dd>
<dt class="tag-title">Throws:</dt>
<dd class="tag-content"><table class="table table-striped throw">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><abbr title="java.lang.IllegalArgumentException">IllegalArgumentException</abbr></code></td>
<td>
<p>if <code>updateRate  0</code>.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Returns:</dt>
<dd class="tag-content"><table class="table table-striped return">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><a href="./">Builder</a></code></td>
<td>
<p>this builder.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
  <div class="panel panel-default member-definition" id="withMininumMeasurements%28int%29">
    <div class="panel-heading method-heading">
      <a class="anchor" href="#withMininumMeasurements%28int%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      <code><a href="./">Builder</a></code> withMininumMeasurements <big>(</big><code>int</code> minMeasure<big>)</big>
    </div>
    <div class="panel-body method-body">
      <p>Sets the minimum number of measurements per-host to consider for the resulting latency aware policy. </p>
<p> Penalizing nodes is based on an average of their recently measured average latency. This average is only meaningful if a minimum of measurements have been collected (moreover, a newly started Cassandra node will tend to perform relatively poorly on the first queries due to the JVM warmup). This is what this option controls. If less that <code>minMeasure</code> data points have been collected for a given host, the policy will never penalize that host. Also, the 30% first measurement will be entirely ignored (in other words, the <code>30% * minMeasure</code> first measurement to a node are entirely ignored, while the <code>70%</code> next ones are accounted in the latency computed but the node wonâ€™t get convicted until weâ€™ve had at least <code>minMeasure</code> measurements). </p>
<p> Note that the number of collected measurements for a given host is reset if the node is restarted. </p>
<p> The default for this option (if this method is not called) is <b>50</b>. Note that it is probably not a good idea to put this option too low if only to avoid the influence of JVM warm-up on newly restarted nodes.</p>

      <dl class="tags">
<dt class="tag-title">Parameters:</dt>
<dd class="tag-content"><table class="table table-striped param">
<thead><tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><var>minMeasure</var></td>
<td><code>int</code></td>
<td>
<p>the minimum measurements to consider.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Throws:</dt>
<dd class="tag-content"><table class="table table-striped throw">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><abbr title="java.lang.IllegalArgumentException">IllegalArgumentException</abbr></code></td>
<td>
<p>if <code>minMeasure  0</code>.</p>
</td>
</tr></tbody>
</table></dd>
<dt class="tag-title">Returns:</dt>
<dd class="tag-content"><table class="table table-striped return">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><a href="./">Builder</a></code></td>
<td>
<p>this builder.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
  <div class="panel panel-default member-definition" id="build%28%29">
    <div class="panel-heading method-heading">
      <a class="anchor" href="#build%28%29" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
      <code><a href="../LatencyAwarePolicy/">LatencyAwarePolicy</a></code> build <big>(</big><big>)</big>
    </div>
    <div class="panel-body method-body">
      <p>Builds a new latency aware policy using the options set on this builder.</p>

      <dl class="tags">
<dt class="tag-title">Returns:</dt>
<dd class="tag-content"><table class="table table-striped return">
<thead><tr>
<th class="type">Type</th>
<th class="details">Details</th>
</tr></thead>
<tbody><tr>
<td><code><a href="../LatencyAwarePolicy/">LatencyAwarePolicy</a></code></td>
<td>
<p>the newly created <code>LatencyAwarePolicy</code>.</p>
</td>
</tr></tbody>
</table></dd>
</dl>
    </div>
  </div>
  
</div>


        </div>
        <div class="col-md-3">
          <div id="navigation" class="panel-group side-nav" data-spy="affix" data-offset-top="60" data-offset-bottom="54" role="tablist" aria-multiselectable="true">
            <div id="table-of-contents-panel" class="panel panel-default">
              <div id="table-of-contents-heading" class="panel-heading" role="tab">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#table-of-contents" aria-expanded="true" aria-controls="table-of-contents">
                    Contents<i class="pull-right glyphicon glyphicon-chevron-up"></i>
                  </a>
                </h4>
              </div>
              <div id="table-of-contents" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="table-of-contents-heading">
                <div class="panel-body">
                  <ol class="nav nav-pills nav-stacked toc">
<li><a href="#extends">Extends
</a></li>
<li><a href="#constructors">Constructors
</a></li>
<li><a href="#methods">Methods
</a></li>
</ol>
                </div>
              </div>
            </div>

            
          </div>
        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="https://github.com/datastax/java-driver/">Code</a>
        </li>
      
        <li>Â·</li>
        <li>
          <a href="http://datastax.github.io/java-driver/">Docs</a>
        </li>
      
        <li>Â·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/JAVA/">Issues</a>
        </li>
      
        <li>Â·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/java-driver-user">Mailing List</a>
        </li>
      
        <li>Â·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>Â·</li>
        <li>
          <a href="https://github.com/datastax/java-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../../../js/jquery.js"></script>
    <script src="../../../js/bootstrap.js"></script>
    <script src="../../../js/angular.js"></script>
    <script src="../../../js/mousetrap.js"></script>
    <script src="../../../js/hotkeys.js"></script>
    <script src="../../../js/ZeroClipboard.js"></script>
    <script src="../../../js/lunr.js"></script>
    <script src="../../../js/app.js"></script>
  </body>
</html>
