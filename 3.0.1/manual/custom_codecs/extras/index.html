<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="High performance Java client for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>Java Driver for Apache Cassandra - Optional codecs</title>

    <link rel="icon" href="../../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../../favicon.png">
    <link href="../../../../css/style.css" rel="stylesheet">
    <link href="../../../../css/pygments.css" rel="stylesheet">
    <link href="../../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs">
    <div class="navbar">
      <div class="container-fluid">
        <div class="row row-offcanvas row-offcanvas-left">
          <div class="col-sm-3 text-center">
            <a class="ds-home" href="../../../"><img alt="Brand" src="../../../../img/logo.png"></a>
            <ul class="list-inline ds-sites" role="nav">
              <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
              <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
              <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
            </ul>
          </div>
          <div class="col-md-5">
            <p class="lead pubtitle">Java Driver for Apache Cassandra</p>
            
            <div class="text-info">
              <span class="text-warning">Attention:</span> Viewing documentation for version
              <div class="btn-group">
                <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  3.0.1
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                
                  <li><a href="../../../../manual/custom_codecs/extras/">3.1.0</a></li>
                
                  <li><a href="../../../../3.0.3/manual/custom_codecs/extras/">3.0.3</a></li>
                
                  <li class="disabled"><a href="./">3.0.1</a></li>
                
                  <li><a href="../../../../3.0.0/manual/custom_codecs/extras/">3.0.0</a></li>
                
                  <li><a href="../../../../2.1.10.1/">2.1.10.1</a></li>
                
                  <li><a href="../../../../2.1.10/">2.1.10</a></li>
                
                  <li><a href="../../../../2.1.9/">2.1.9</a></li>
                
                  <li><a href="../../../../2.1.8/">2.1.8</a></li>
                
                  <li><a href="../../../../2.1.7/">2.1.7</a></li>
                
                  <li><a href="../../../../2.0.12.1/">2.0.12.1</a></li>
                
                  <li><a href="../../../../2.0.12/">2.0.12</a></li>
                
                  <li><a href="../../../../2.0.11/">2.0.11</a></li>
                
                </ul>
              </div>
            </div>
            
          </div>
          <div class="col-md-4">
            <form id="search" class="form-search dropdown visible-lg-inline-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
              <div class="form-group has-feedback">
                <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('3.0.1')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
              </div>
              <ul class="dropdown-menu search-results" role="menu">
                <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
              </ul>
            </form>
            <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3><a href="../../../">Contents</a></h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../../../changelog/">
      Changelog <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../../faq/">
      Frequently Asked Questions <small>page</small>
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="../../">
      Manual <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../../address_resolution/">
      Address resolution <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../async/">
      Asynchronous programming <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../auth/">
      Authentication <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../compression/">
      Compression <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../pooling/">
      Connection pooling <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../control_connection/">
      Control connection <small>page</small>
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="../">
      Custom Codecs <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li class="active">
    <a href="./" class="current">
      Optional codecs <small>page</small>
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
</ul>

  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../custom_payloads/">
      Custom Payloads <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../load_balancing/">
      Load balancing <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../logging/">
      Logging <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../metadata/">
      Metadata <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../metrics/">
      Metrics <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../native_protocol/">
      Native protocol <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../object_mapper/">
      Object Mapper <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../paging/">
      Paging <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../idempotence/">
      Query idempotence <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../query_timestamps/">
      Query timestamps <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../reconnection/">
      Reconnection <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../retries/">
      Retries <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../ssl/">
      SSL <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../socket_options/">
      Socket options <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../speculative_execution/">
      Speculative query execution <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../statements/">
      Statements <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../tuples/">
      Tuples <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../udts/">
      User-defined types <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../shaded_jar/">
      Using the shaded JAR <small>page</small>
      
    </a>
    
  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../../upgrade_guide/">
      Upgrade guide <small>page</small>
      
    </a>
    
  </li>
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          <div class="crumbs-wrapper">
            <nav id="crumbs" data-spy="affix" data-offset-top="130">
              <ol class="breadcrumb">
                
                
                
                <li><a href="../../../">Home</a></li>
                
                
                
                
                
                <li><a href="../../">Manual</a></li>
                
                
                
                
                
                <li><a href="../">Custom Codecs</a></li>
                
                
                
                
                
                <li class="active">Optional codecs</li>
                
                
                
              </ol>
            </nav>
          </div>
          

<h2 id="optional-codecs" class="target">Optional codecs<a class="anchor" href="#optional-codecs" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>The driver’s “extras” module provides additional <a href="../">codec</a> implementations: these codecs are not required by core
driver features, but will probably prove useful in a lot of client applications. You can also study their source code as
a reference to write your own.</p>

<p>The module is published as a separate Maven artifact:</p>
<pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.datastax.cassandra<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cassandra-driver-extras<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.0.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
<p>It also declares a number of optional dependencies, that you’ll need to explicitly re-declare in your application
depending on which codecs you plan to use (this will be covered for each case below).</p>

<h3 id="temporal-types" class="target">Temporal types<a class="anchor" href="#temporal-types" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>JDK 8 and Joda Time support have often been requested; they’re not in the core module because we want to preserve
compatibility with older JDKs and avoid extra dependencies.</p>

<h4 id="jdk-8" class="target">JDK 8<a class="anchor" href="#jdk-8" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/jdk8/InstantCodec.html">InstantCodec</a> maps <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html">Instant</a> to CQL’s <code>timestamp</code>:</p>
<pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.datastax.driver.extras.codecs.jdk8.InstantCodec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.Instant</span><span class="o">;</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
    <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">InstantCodec</span><span class="o">.</span><span class="na">instance</span><span class="o">);</span>

<span class="c1">// schema: CREATE TABLE example(id int PRIMARY KEY, t timestamp)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"INSERT INTO example (id, t) VALUES (1, ?)"</span><span class="o">,</span>
        <span class="n">Instant</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2010-06-30T01:20:30Z"</span><span class="o">));</span>
</code></pre>
<p>Similarly:</p>

<ul>
<li>
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/jdk8/LocalDateCodec.html">LocalDateCodec</a> maps <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html">LocalDate</a> to <code>date</code>;</li>
<li>
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/jdk8/LocalTimeCodec.html">LocalTimeCodec</a> maps <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalTime.html">LocalTime</a> to <code>time</code>.</li>
</ul>

<p>One problem with <code>timestamp</code> is that it does not store time zones. <a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/jdk8/ZonedDateTimeCodec.html">ZonedDateTimeCodec</a> addresses that, by mapping a
<a href="https://docs.oracle.com/javase/8/docs/api/java/time/ZonedDateTime.html">ZonedDateTime</a> to a <code>tuple&lt;timestamp,varchar&gt;</code>:</p>
<pre class="highlight"><code><span class="c1">// Due to internal implementation details, you have to retrieve the tuple type from a live cluster:</span>
<span class="n">TupleType</span> <span class="n">tupleType</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="na">getMetadata</span><span class="o">()</span>
        <span class="o">.</span><span class="na">newTupleType</span><span class="o">(</span><span class="n">DataType</span><span class="o">.</span><span class="na">timestamp</span><span class="o">(),</span> <span class="n">DataType</span><span class="o">.</span><span class="na">varchar</span><span class="o">());</span>
<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">ZonedDateTimeCodec</span><span class="o">(</span><span class="n">tupleType</span><span class="o">));</span>

<span class="c1">// schema: CREATE TABLE example(id int PRIMARY KEY, t tuple&lt;timestamp,varchar&gt;)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"INSERT INTO example (id, t) VALUES (1, ?)"</span><span class="o">,</span>
        <span class="n">ZonedDateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2010-06-30T01:20:47.999+01:00"</span><span class="o">));</span>
</code></pre>
<h4 id="joda-time" class="target">Joda time<a class="anchor" href="#joda-time" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p>These codecs require an explicit dependency on Joda Time in your application:</p>
<pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>joda-time<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>joda-time<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.9.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
<p>Like for JDK8, there is a codec for each time type:</p>

<ul>
<li>
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/joda/InstantCodec.html">InstantCodec</a>: <a href="http://www.joda.org/joda-time/apidocs/org/joda/time/Instant.html">Instant</a> to <code>timestamp</code>;</li>
<li>
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/joda/LocalDateCodec.html">LocalDateCodec</a>: <a href="http://www.joda.org/joda-time/apidocs/org/joda/time/LocalDate.html">LocalDate</a> to <code>date</code>;</li>
<li>
<a href="http://www.joda.org/joda-time/apidocs/org/joda/time/LocalTime.html">LocalTime</a>: <a href="http://www.joda.org/joda-time/apidocs/org/joda/time/LocalTime.html">LocalTime</a> to <code>time</code>.</li>
</ul>
<pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.datastax.driver.extras.codecs.joda.InstantCodec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.joda.time.Instant</span><span class="o">;</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">InstantCodec</span><span class="o">.</span><span class="na">instance</span><span class="o">);</span>

<span class="c1">// schema: CREATE TABLE example(id int PRIMARY KEY, t timestamp)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"INSERT INTO example (id, t) VALUES (1, ?)"</span><span class="o">,</span>
        <span class="n">Instant</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2010-06-30T01:20:30Z"</span><span class="o">));</span>
</code></pre>
<p>And <a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/joda/DateTimeCodec.html">DateTimeCodec</a> can save <a href="http://www.joda.org/joda-time/apidocs/org/joda/time/DateTime.html">DateTime</a> instances with a time zone:</p>
<pre class="highlight"><code><span class="n">TupleType</span> <span class="n">tupleType</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="na">getMetadata</span><span class="o">()</span>
        <span class="o">.</span><span class="na">newTupleType</span><span class="o">(</span><span class="n">DataType</span><span class="o">.</span><span class="na">timestamp</span><span class="o">(),</span> <span class="n">DataType</span><span class="o">.</span><span class="na">varchar</span><span class="o">());</span>
<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">DateTimeCodec</span><span class="o">(</span><span class="n">tupleType</span><span class="o">));</span>

<span class="c1">// schema: CREATE TABLE example(id int PRIMARY KEY, t tuple&lt;timestamp,varchar&gt;)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"INSERT INTO example (id, t) VALUES (1, ?)"</span><span class="o">,</span>
        <span class="n">DateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2010-06-30T01:20:47.999+01:00"</span><span class="o">));</span>
</code></pre>
<h4 id="primitive-types" class="target">Primitive types<a class="anchor" href="#primitive-types" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p>Time can also be expressed as simple durations:</p>

<ul>
<li>
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/date/SimpleTimestampCodec.html">SimpleTimestampCodec</a> maps <code>timestamp</code> to a primitive Java <code>long</code> representing the number of milliseconds since the
Epoch;</li>
<li>
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/date/SimpleDateCodec.html">SimpleDateCodec</a> maps <code>date</code> to a primitive Java <code>int</code> representing the number of milliseconds since the Epoch.</li>
</ul>

<p>There is no extra codec for <code>time</code>, because by default the driver already maps that type to a <code>long</code> representing the
number of milliseconds since midnight.</p>

<h3 id="enums" class="target">Enums<a class="anchor" href="#enums" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>Enums can be mapped in two different ways:</p>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/enums/EnumNameCodec.html">EnumNameCodec</a> stores enum constants as a <code>varchar</code> representing their <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html#name--">name</a>:</p>
<pre class="highlight"><code><span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span><span class="n">INIT</span><span class="o">,</span> <span class="n">RUNNING</span><span class="o">,</span> <span class="n">STOPPING</span><span class="o">,</span> <span class="n">STOPPED</span><span class="o">}</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">EnumNameCodec</span><span class="o">&lt;</span><span class="n">State</span><span class="o">&gt;(</span><span class="n">State</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="c1">// schema: create table name_example(id int PRIMARY KEY, state text)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"insert into name_example (id, state) values (1, ?)"</span><span class="o">,</span> <span class="n">State</span><span class="o">.</span><span class="na">INIT</span><span class="o">);</span>
<span class="c1">// state is saved as 'INIT'</span>
</code></pre>
<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/enums/EnumOrdinalCodec.html">EnumOrdinalCodec</a> stores enum constants as an <code>int</code> representing their <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html#ordinal--">ordinal</a>:</p>
<pre class="highlight"><code><span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span><span class="n">INIT</span><span class="o">,</span> <span class="n">RUNNING</span><span class="o">,</span> <span class="n">STOPPING</span><span class="o">,</span> <span class="n">STOPPED</span><span class="o">}</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">EnumOrdinalCodec</span><span class="o">&lt;</span><span class="n">State</span><span class="o">&gt;(</span><span class="n">State</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="c1">// schema: create table ordinal_example(id int PRIMARY KEY, state int)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"insert into ordinal_example (id, state) values (1, ?)"</span><span class="o">,</span> <span class="n">State</span><span class="o">.</span><span class="na">INIT</span><span class="o">);</span>
<span class="c1">// state saved as 0</span>
</code></pre>
<p>Note that if you registered both codecs at the same time, there would be a problem: because <code>session.execute</code> uses a
<a href="../../statements/simple/">simple statement</a>, the target CQL type is not known in advance, so the driver picks the first
codec that accepts a <code>State</code>. So one of the statements would serialize its value to the wrong type, and the request
would fail on the server side.</p>

<p>In practice, this is unlikely to happen, because you’ll probably stick to a single CQL type for a given enum type;
however, if you ever run into that issue, the workaround is to use <a href="../../statements/prepared/">prepared statements</a>,
for which the driver knows the CQL type and can pick the exact codec.</p>

<h3 id="json" class="target">JSON<a class="anchor" href="#json" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<h4 id="jackson" class="target">Jackson<a class="anchor" href="#jackson" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/json/JacksonJsonCodec.html">JacksonJsonCodec</a> maps a Java object to a JSON string stored into a <code>varchar</code> column, using the popular <a href="http://wiki.fasterxml.com/JacksonHome">Jackson</a>
library.</p>

<p>It requires an explicit dependency on Jackson in your application:</p>
<pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.6.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
<pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@JsonCreator</span>
    <span class="kd">public</span> <span class="n">User</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">...</span> <span class="c1">// getters and setters</span>
<span class="o">}</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">JacksonJsonCodec</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="c1">// schema: create table example(id int primary key, owner varchar);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"insert into example (id, owner) values (1, ?)"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"root"</span><span class="o">));</span>
<span class="c1">// owner saved as '{"id":1,"name":"root"}'</span>
</code></pre>
<h4 id="jsr-353" class="target">JSR 353<a class="anchor" href="#jsr-353" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/json/Jsr353JsonCodec.html">Jsr353JsonCodec</a> maps a <a href="https://javaee-spec.java.net/nonav/javadocs/javax/json/JsonStructure.html">JsonStructure</a> to a JSON string stored into a <code>varchar</code> column, using the JSR-353 standard.</p>

<p>It requires an explicit dependency on the JSR-353 API and an implementation:</p>
<pre class="highlight"><code><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">javax</span><span class="o">.</span><span class="na">json</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">javax</span><span class="o">.</span><span class="na">json</span><span class="o">-</span><span class="n">api</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>

<span class="o">&lt;!--</span> <span class="n">Reference</span> <span class="n">implementation</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">glassfish</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">javax</span><span class="o">.</span><span class="na">json</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">4</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</code></pre>
<pre class="highlight"><code><span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">Jsr353JsonCodec</span><span class="o">());</span>

<span class="c1">// schema: create table example(id int primary key, owner varchar);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"insert into example (id, owner) values (1, ?)"</span><span class="o">,</span>
        <span class="n">javax</span><span class="o">.</span><span class="na">json</span><span class="o">.</span><span class="na">Json</span><span class="o">.</span><span class="na">createObjectBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"root"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">());</span>
<span class="c1">// owner saved as '{"id":1,"name":"root"}'</span>
</code></pre>
<h3 id="optional" class="target">Optional<a class="anchor" href="#optional" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>“Optional” types provide an alternate way to represent missing values, in an attempt to avoid null pointer errors. With
these codecs, missing values will be mapped to <code>NULL</code> in the database.</p>

<h4 id="jdk8" class="target">JDK8<a class="anchor" href="#jdk8" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/jdk8/OptionalCodec.html">OptionalCodec</a> transforms another codec to wrap its Java type in a JDK8 <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a>.</p>
<pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.datastax.driver.extras.codecs.jdk8.OptionalCodec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.reflect.TypeToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="c1">// The built-in driver codec, that maps CQL's int to Java's Integer</span>
<span class="n">TypeCodec</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">intCodec</span> <span class="o">=</span> <span class="n">TypeCodec</span><span class="o">.</span><span class="na">cint</span><span class="o">();</span>

<span class="c1">// A codec that maps CQL's int to Java's Optional&lt;Integer&gt;</span>
<span class="n">OptionalCodec</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">optionalIntCodec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OptionalCodec</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">intCodec</span><span class="o">);</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">optionalIntCodec</span><span class="o">);</span>

<span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">optionalIntToken</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;()</span> <span class="o">{};</span>

<span class="c1">// schema: create table example (id int primary key, v int);</span>
<span class="n">PreparedStatement</span> <span class="n">pst</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">"insert into example (id, v) values (?, ?)"</span><span class="o">);</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pst</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"v"</span><span class="o">,</span> <span class="n">v1</span><span class="o">,</span> <span class="n">optionalIntToken</span><span class="o">));</span>
<span class="c1">// v1 saved as NULL</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pst</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"v"</span><span class="o">,</span> <span class="n">v2</span><span class="o">,</span> <span class="n">optionalIntToken</span><span class="o">));</span>
<span class="c1">// v2 saved as 12</span>
</code></pre>
<p>This example is a bit more complex: <code>Optional&lt;Integer&gt;</code> is a generic type, so we can’t use simple statements, because
they select codecs according to the runtime types of their values (and we would lose the <code>&lt;Integer&gt;</code> part with type
erasure).</p>

<p>For the same reason, we need to give a type hint when setting “v”, in the form of a <a href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/reflect/TypeToken.html">TypeToken</a>. Note that this is an
anonymous inner class; we recommend storing these tokens as constants in a utility class, to avoid creating them too
often.</p>

<h4 id="guava" class="target">Guava<a class="anchor" href="#guava" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h4>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/guava/OptionalCodec.html">OptionalCodec</a> transforms another codec to wrap its Java type in a Guava
<a href="http://docs.guava-libraries.googlecode.com/git-history/v16.0.1/javadoc/com/google/common/base/Optional.html">Optional</a>.</p>
<pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.datastax.driver.extras.codecs.guava.OptionalCodec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.base.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.reflect.TypeToken</span><span class="o">;</span>

<span class="c1">// The built-in driver codec, that maps CQL's int to Java's Integer</span>
<span class="n">TypeCodec</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">intCodec</span> <span class="o">=</span> <span class="n">TypeCodec</span><span class="o">.</span><span class="na">cint</span><span class="o">();</span>

<span class="c1">// A codec that maps CQL's int to Guava's Optional&lt;Integer&gt;</span>
<span class="n">OptionalCodec</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">optionalIntCodec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OptionalCodec</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">intCodec</span><span class="o">);</span>

<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">optionalIntCodec</span><span class="o">);</span>

<span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">optionalIntToken</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
<span class="o">};</span>

<span class="c1">// schema: create table example (id int primary key, v int);</span>
<span class="n">PreparedStatement</span> <span class="n">pst</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">"insert into example (id, v) values (?, ?)"</span><span class="o">);</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">absent</span><span class="o">();</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pst</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"v"</span><span class="o">,</span> <span class="n">v1</span><span class="o">,</span> <span class="n">optionalIntToken</span><span class="o">));</span>
<span class="c1">// v1 saved as NULL</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">pst</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"v"</span><span class="o">,</span> <span class="n">v2</span><span class="o">,</span> <span class="n">optionalIntToken</span><span class="o">));</span>
<span class="c1">// v2 saved as 12</span>
</code></pre>
<p>See the JDK8 Optional section above for explanations about <a href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/reflect/TypeToken.html">TypeToken</a>.</p>

<h3 id="arrays" class="target">Arrays<a class="anchor" href="#arrays" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>By default, the driver maps CQL lists to collections of Java objects. For high-performance scenarios, and when the
element type maps to a Java primitive, you might want to map to an array instead, to avoid unnecessary boxing and
unboxing.</p>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/arrays/IntArrayCodec.html">IntArrayCodec</a> allows you to do that for lists of integers:</p>
<pre class="highlight"><code><span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getCodecRegistry</span><span class="o">()</span>
        <span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">IntArrayCodec</span><span class="o">());</span>

<span class="c1">// schema: create table example (i int primary key, l list&lt;int&gt;)</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"insert into example (i, l) values (1, ?)"</span><span class="o">,</span>
        <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">});</span>
<span class="c1">// array saved as [1,2,3]</span>
</code></pre>
<p>Package <a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/arrays/package-summary.html">com.datastax.driver.extras.codecs.arrays</a> contains similar codecs for all primitive types, and
<a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/arrays/ObjectArrayCodec.html">ObjectArrayCodec</a> to map arrays of objects.</p>

<h3 id="abstract-utilities" class="target">Abstract utilities<a class="anchor" href="#abstract-utilities" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>The module provides two abstract classes that act as building blocks for your own codecs:</p>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/MappingCodec.html">MappingCodec</a> is useful when you can easily convert your Java type to another type that already has a codec.
For example, if you have a <code>Price</code> object that translates to a plain <code>Integer</code>, you can piggyback on the built-in
integer codec, and you’ll only have to write two simple conversion methods:</p>
<pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PriceCodec</span> <span class="kd">extends</span> <span class="n">MappingCodec</span><span class="o">&lt;</span><span class="n">Price</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">PriceCodec</span><span class="o">()</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">TypeCodec</span><span class="o">.</span><span class="na">cint</span><span class="o">(),</span> <span class="n">Price</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Integer</span> <span class="n">serialize</span><span class="o">(</span><span class="n">Price</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Price</span> <span class="n">deserialize</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>For a more detailed example, you can look at the <code>OptionalCodec</code> implementations in the source code.</p>

<p><a href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/extras/codecs/ParsingCodec.html">ParsingCodec</a> is similar, but specialized for text columns. See <code>EnumNameCodec</code> for an example.</p>

<p>These two classes are convenient, but since they perform conversions in two steps, extending them is not necessarily the
optimal approach. If performance is paramount, it’s better to start from scratch and convert your objects to
<code>ByteBuffer</code> directly.</p>


        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="https://github.com/datastax/java-driver/">Code</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="http://datastax.github.io/java-driver/">Docs</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/JAVA/">Issues</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/java-driver-user">Mailing List</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/java-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../../../../js/jquery.js"></script>
    <script src="../../../../js/bootstrap.js"></script>
    <script src="../../../../js/angular.js"></script>
    <script src="../../../../js/mousetrap.js"></script>
    <script src="../../../../js/hotkeys.js"></script>
    <script src="../../../../js/ZeroClipboard.js"></script>
    <script src="../../../../js/lunr.js"></script>
    <script src="../../../../js/app.js"></script>
  </body>
</html>
