# master uses a Gatling DSE plugin based on 3.x
# DSP-17972-unified-driver uses a Gatling DSE plugin based on the unified driver (>= 4.5.x)
branch: "master"

---

ensemble:
  observer:
    node.count: 1
    provisioner:
      name: ctool
      properties:
        cloud.provider: nebula
        cloud.instance.type: m3.large
    configuration_manager:
      - name: ctool_monitoring
        properties:
          graphite.create_server: true
  server:
    node.count: 3
    provisioner:
      name: ctool
      properties:
        cloud.provider: nebula
        cloud.tenant: moonshot-v2
        cloud.instance.type: ms2.small
    configuration_manager:
      - name: ctool
        properties:
          product.type: cassandra
          product.install.type: tarball
          product.version: "3.11.6"
      - name: ctool_monitoring
        properties:
          components: OS,JVM,GRAPH
  client:
    node.count: 1
    provisioner:
      name: ctool
      properties:
        cloud.provider: nebula
        cloud.instance.type: m3.xlarge
    configuration_manager:
      - name: ctool
        properties:
          install.maven: true
      - name: gatling
        properties:
          git.repository: git@github.com:riptano/dse-benchmarks.git
          git.branch: {{branch}}

workload:
  phases:
    # This simulation isn't necessary in a single-node case; both Timeseries_Read
    # and Timeseries_Write will create the required keyspace and tables as necessary.
    # We do need it in the multi-node client case.  Without it you can see weird
    # timing errors around the existence of the expected keyspace/table on various nodes.
    - timeseries-schema:
        module: gatling
        properties:
          maven_args: >
              scala:testCompile
              gatling:execute
              -Dgatling.disableCompiler
              -Dgatling.simulationClass=core.timeseries.Timeseries_Schema
    - timeseries-write:
        module: gatling
        properties:
          maven_args: >
              scala:testCompile
              gatling:execute
              -Dgatling.disableCompiler
              -Dgatling.simulationClass=core.timeseries.Timeseries_Write
              -DrowsPerPartition=1000
              -DinjectionType=constant
              -Dthroughput=10000
              -DbenchmarkDurationInMinutes=10
    - timeseries-read:
        module: gatling
        properties:
          maven_args: >
              scala:testCompile
              gatling:execute
              -Dgatling.disableCompiler
              -Dgatling.simulationClass=core.timeseries.Timeseries_Read
              -DrowsPerPartition=1000
              -DinjectionType=constant
              -Dthroughput=10000
              -DbenchmarkDurationInMinutes=10
  checkers:
    nofail:
      checker: nofail
  artifact_checkers:
    systemlog:
      artifact_checker: systemlog
    generate_chart:
      artifact_checker: hdrtool
